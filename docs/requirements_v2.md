这是一个非常具有挑战性和实战意义的阶段！在 OMS 和 Datahub 已经就位的情况下，设计应用平台（UI/控制台）就是为整个系统提供可观测性、可控性和用户接口。我们将应用平台设计为交易系统的中央控制台（Control Console）。

下面是根据您的系统架构（策略、OMS、Datahub、Redis MQ）输出的《量化交易应用平台 (Control Console) 需求文档》。

# 📝 量化交易应用平台 (Control Console) 需求文档

## 🚀 I. 目标与范围

### 1. 目标
*   为用户提供一个统一的界面，监控所有量化策略、账户资金和订单执行情况。
*   实现对策略运行状态（启停、参数）的远程控制和干预。
*   提供手动下单/撤单的接口，作为紧急干预和手动交易的途径。

### 2. 核心用户
*   量化策略开发者（您本人）

### 3. 系统架构集成点

| 组件 | 通信方式 | 目的 |
| :--- | :--- | :--- |
| **API Gateway** | RESTful API / WebSocket | UI 所有请求的统一入口。 |
| **OMS Component** | WebSocket (Event Topic Consumer) | 接收订单状态和成交事件，实时更新 UI。 |
| **Datahub** | RESTful API | 接收实时行情数据、K线数据，用于图表展示。 |
| **Strategy Component** | RESTful API / Redis MQ | 发送策略控制指令（启停），接收策略状态。 |
| **Database** | RESTful API (通过后端服务) | 获取历史订单、成交、资金和绩效数据。 |

## 🖥️ II. 功能模块与详细需求

### 模块 A：账户与资金总览 (Account & Fund Overview)

| ID | 功能名称 | 详细需求 |
| :--- | :--- | :--- |
| A.1 | 账户净值展示 | 实时显示所有交易所账户的总净值（按 USDT 折算）、已用保证金、可用余额。 |
| A.2 | 资金曲线 | 显示账户历史资金曲线（基于数据库记录），支持按天/按周/按月筛选。 |
| A.3 | 交易所余额 | 显示每个交易所账户（如 Binance, OKX）各币种的详细余额和折合 USD 价值。 |

### 模块 B：实时持仓管理 (Real-time Position Management)

| ID | 功能名称 | 详细需求 |
| :--- | :--- | :--- |
| B.1 | 当前持仓列表 | 实时展示当前所有活动持仓，包括：交易对、当前数量、平均持仓成本、实时市值、浮动盈亏（$P\&L$）和 $P\&L\%$。 |
| B.2 | 持仓风险指标 | 计算并展示总风险敞口（Total Exposure）、总杠杆倍数、预估爆仓价格（针对合约）。 |
| B.3 | 平仓操作 | 提供一键平仓按钮，向 OMS 发送平仓请求（市价或限价）。 |

### 模块 C：订单执行与历史 (Order Execution & History)

这是与 OMS 交互最频繁的模块。

| ID | 功能名称 | 详细需求 |
| :--- | :--- | :--- |
| C.1 | 活动订单列表 | 实时更新所有未成交/部分成交的订单。数据来源：OMS Event Topic。需展示：订单 ID、类型、价格、数量、已成交量、所属策略/手动。 |
| C.2 | 订单撤销 | 提供单个订单撤销和一键撤销所有未成交订单的功能。撤销指令发送给 API Gateway $\to$ OMS。 |
| C.3 | 历史成交记录 | 查询数据库中的所有历史成交记录 (oms_trades 表)，支持按时间、交易对、策略进行筛选。 |
| C.4 | 手动下单面板 | 提供一个独立的界面，供用户手动输入订单参数，并发送给 OMS。需集成资金预检查功能。 |

### 模块 D：策略控制与绩效 (Strategy Control & Performance)

| ID | 功能名称 | 详细需求 |
| :--- | :--- | :--- |
| D.1 | 策略状态列表 | 展示当前所有策略的运行状态（RUNNING, STOPPED, FAILED）。 |
| D.2 | 策略启停控制 | 提供 Start/Stop 开关，向策略组件发送控制指令。 |
| D.3 | 参数配置 | 提供表单修改策略的可配置参数（如交易量、MA周期、最大回撤阈值），并将新参数发送给策略组件。 |
| D.4 | 实时绩效 | 实时显示各策略的运行绩效：当日盈亏、总盈亏、夏普比率、最大回撤等（数据来源：数据库）。 |
| D.5 | 策略日志 | 实时显示策略组件的关键运行日志和错误/警报信息（通过 Log Aggregation System 或 API）。 |

### 模块 E：系统监控与警报 (System Monitoring & Alerts)

| ID | 功能名称 | 详细需求 |
| :--- | :--- | :--- |
| E.1 | 连接状态监控 | 实时显示 Datahub、OMS、Redis MQ 与交易所 API 的连接状态（OK/DISCONNECTED）。 |
| E.2 | 风控/错误警报 | 当 OMS 返回 ORDER_REJECTED 或策略组件发送 RISK_ALERT 事件时，在 UI 上弹出红色警告，并有声音提示。 |
| E.3 | 消息队列状态 | 显示 Redis 订单队列中的待处理消息数量（用于监控 OMS 的处理延迟）。 |

## 🎨 III. 技术与用户体验要求

### 1. 前端技术栈
*   **推荐**： React, Vue.js 或 Angular (选择您最熟悉的前端框架)。
*   **通信**： 必须使用 WebSocket 接收来自 OMS Event Topic 和 Datahub 的实时数据推送，确保界面的实时性。

### 2. 后端 API 设计
应用平台应调用一个专用的后端服务（可能集成在您的 API Gateway 后方），该服务负责：
*   处理用户的认证/权限。
*   将 UI 的指令转发给 Redis MQ (如手动下单)。
*   聚合数据库数据（如历史绩效）。

### 3. 用户体验 (UX)
*   **实时性**： 订单状态和持仓数据更新延迟应小于 500ms。
*   **紧急响应**： 撤单和手动平仓按钮应醒目，且操作流程尽量简化。
*   **颜色区分**： 使用颜色区分状态：例如，红色表示亏损/警报/卖出；绿色表示盈利/成功/买入。

---
这个需求文档为您提供了清晰的蓝图。您可以基于此开始前端和后端 API 的开发工作。
