# CryptoQuant 个人量化交易系统应用平台 - 产品需求文档

> 版本: v1.0.0  
> 更新日期: 2026-01-30  
> 文档状态: 草案

---

## 目录

- [1. 项目概述](#1-项目概述)
- [2. 系统架构](#2-系统架构)
- [3. 核心功能模块](#3-核心功能模块)
- [4. 扩展功能模块](#4-扩展功能模块)
- [5. 技术规范](#5-技术规范)
- [6. 界面设计规范](#6-界面设计规范)
- [7. 安全需求](#7-安全需求)
- [8. 非功能性需求](#8-非功能性需求)
- [9. 项目规划](#9-项目规划)
- [10. 附录](#10-附录)

---

## 1. 项目概述

### 1.1 项目背景

CryptoQuant 是一个面向个人交易者的专业量化交易系统应用平台，旨在整合多交易所的交易能力、市场数据和智能分析，为用户提供一站式的加密货币量化交易解决方案。

### 1.2 项目目标

- 提供统一的多交易所交易管理能力（Binance、OKX、Gate.io）
- 整合实时市场数据和专业图表工具
- 支持智能订单（组合单、止损止盈）
- 集成 AI 辅助交易决策
- 提供全面的资产和风险监控
- 预留策略自动化交易能力

### 1.3 目标用户

- 个人加密货币交易者
- 量化交易爱好者
- 希望系统化管理交易的投资者

### 1.4 核心价值

| 价值点 | 描述 |
|-------|------|
| **统一管理** | 多交易所账户集中管理，一站式操作 |
| **专业工具** | TradingView 图表 + 订单簿深度，专业交易体验 |
| **智能交易** | 组合单、条件单，自动化止盈止损 |
| **数据驱动** | 完整的历史数据、P&L 分析、资产追踪 |
| **AI 辅助** | 大模型驱动的市场分析和交易建议 |

---

## 2. 系统架构

### 2.1 整体架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           用户层 (User Layer)                            │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │                         Web UI (React/Vue)                          │ │
│  │   Dashboard │ Trading │ Orders │ Portfolio │ Strategy │ Settings   │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────┘
                                     │
                                     │ HTTPS/WSS
                                     ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                        应用层 (Application Layer)                        │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │                    app-backend (BFF/API Gateway)                    │ │
│  │  ┌───────────┬───────────┬───────────┬───────────┬───────────┐     │ │
│  │  │   Auth    │  Account  │   Trade   │  Market   │    AI     │     │ │
│  │  │  Module   │  Module   │  Module   │  Module   │  Module   │     │ │
│  │  └───────────┴───────────┴───────────┴───────────┴───────────┘     │ │
│  │  ┌───────────┬───────────┬───────────┬───────────┬───────────┐     │ │
│  │  │  Alert    │ Portfolio │  Strategy │   News    │   Admin   │     │ │
│  │  │  Module   │  Module   │  Module   │  Module   │  Module   │     │ │
│  │  └───────────┴───────────┴───────────┴───────────┴───────────┘     │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────┘
                                     │
                    ┌────────────────┼────────────────┐
                    │                │                │
                    ▼                ▼                ▼
┌──────────────────────┐ ┌──────────────────┐ ┌──────────────────────┐
│      OMS Service     │ │  DataHub Service │ │   External Services  │
│  ┌────────────────┐  │ │ ┌──────────────┐ │ │  ┌────────────────┐  │
│  │ Order Mgmt     │  │ │ │ Market Data  │ │ │  │ Exchange APIs  │  │
│  │ Bracket Order  │  │ │ │ Ledger Data  │ │ │  │ TradingView    │  │
│  │ Risk Control   │  │ │ │ Jobs/Backfill│ │ │  │ LLM APIs       │  │
│  └────────────────┘  │ │ └──────────────┘ │ │  │ News APIs      │  │
└──────────────────────┘ └──────────────────┘ │  └────────────────┘  │
                                              └──────────────────────┘
```

### 2.2 服务命名规范

| 服务 | 目录名 | 描述 |
|-----|--------|------|
| **前端应用** | `web-ui/` | React/Vue Web 应用 |
| **后端服务** | `app-backend/` | 应用平台后端 (BFF 层) |
| **API网关** | `api-gateway/` | API 网关层 (可选，如需要单独网关) |
| **OMS 服务** | 外部服务 | 订单管理系统 |
| **DataHub 服务** | 外部服务 | 数据中心服务 |

> **后端命名建议**: 推荐使用 `app-backend` 作为后端服务名称，体现其作为应用平台后端的角色。如果 `api-gateway` 已包含业务逻辑，可以将其重命名为 `app-backend`，或保持 `api-gateway` 作为纯网关，新建 `app-backend` 处理业务逻辑。

### 2.3 技术栈

| 层级 | 技术选型 | 说明 |
|-----|---------|------|
| **前端** | React 18 + TypeScript | 主流框架，生态丰富 |
| **UI 框架** | Tailwind CSS + shadcn/ui | 现代化 UI 组件库 |
| **图表** | TradingView Charting Library | 专业 K 线图表 |
| **状态管理** | Zustand / Jotai | 轻量级状态管理 |
| **后端** | Python 3.11+ (FastAPI) | 高性能异步框架 |
| **数据库** | PostgreSQL + Redis | 主数据库 + 缓存 |
| **消息队列** | Redis Pub/Sub | 实时推送 |
| **AI** | OpenAI / Claude API | 大模型接口 |

---

## 3. 核心功能模块

### 3.1 认证与授权模块 (Auth Module)

#### 3.1.1 用户注册

**功能描述**: 新用户创建账户

**注册方式**:
- 用户名 + 密码注册
- 邮箱验证 (可选)

**输入参数**:

| 字段 | 类型 | 必填 | 验证规则 |
|-----|------|-----|---------|
| `username` | string | 是 | 4-32 字符，字母数字下划线 |
| `password` | string | 是 | 8-64 字符，包含大小写字母和数字 |
| `email` | string | 否 | 有效邮箱格式 |
| `display_name` | string | 否 | 2-50 字符 |

**业务规则**:
1. 用户名唯一性校验
2. 密码使用 bcrypt 加密存储
3. 注册成功后自动登录

#### 3.1.2 用户登录

**功能描述**: 用户身份验证并获取访问令牌

**请求参数**:

| 字段 | 类型 | 必填 | 说明 |
|-----|------|-----|------|
| `username` | string | 是 | 用户名 |
| `password` | string | 是 | 密码 |

**响应**:

```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIs...",
  "token_type": "bearer",
  "expires_in": 86400,
  "refresh_token": "eyJhbGciOiJIUzI1NiIs..."
}
```

**JWT Token 规范**:

```json
{
  "alg": "HS256",
  "typ": "JWT"
}
{
  "sub": "user_id",
  "username": "trader01",
  "scopes": ["read:market", "write:orders", "read:balances"],
  "iat": 1706620800,
  "exp": 1706707200,
  "jti": "unique-token-id"
}
```

**Token 用途**:
- 访问 OMS API
- 访问 DataHub API
- 访问 App Backend API

#### 3.1.3 Token 刷新

**端点**: `POST /api/v1/auth/refresh`

**请求**:
```json
{
  "refresh_token": "eyJhbGciOiJIUzI1NiIs..."
}
```

**业务规则**:
- Access Token 有效期: 24 小时
- Refresh Token 有效期: 7 天
- Refresh Token 单次使用后失效

#### 3.1.4 登出

**端点**: `POST /api/v1/auth/logout`

**业务规则**:
- 将当前 Token 加入黑名单
- 清除客户端存储的 Token

---

### 3.2 Dashboard 模块

#### 3.2.1 资产概览

**功能描述**: 展示用户在各交易所的资产总览

**展示内容**:

| 指标 | 数据来源 | 更新频率 |
|-----|---------|---------|
| 总资产价值 (USD/USDT) | DataHub + OMS | 实时 |
| 24h 资产变化 | 计算得出 | 实时 |
| 资产分布饼图 | DataHub | 1 分钟 |
| 各账户余额 | OMS | 1 分钟 |

**资产分布展示**:
```
┌─────────────────────────────────────────┐
│  总资产: $125,430.56  (+2.34% 24h)      │
├─────────────────────────────────────────┤
│  ┌─────────┐  BTC    45.2%  $56,694.49  │
│  │  饼图   │  ETH    30.1%  $37,754.59  │
│  │         │  USDT   18.5%  $23,204.65  │
│  └─────────┘  Others  6.2%  $7,776.83   │
├─────────────────────────────────────────┤
│  账户分布:                               │
│  ├─ Binance:   $78,500.00  (62.6%)      │
│  ├─ OKX:       $35,430.56  (28.3%)      │
│  └─ Gate.io:   $11,500.00  (9.1%)       │
└─────────────────────────────────────────┘
```

#### 3.2.2 P&L (盈亏分析)

**功能描述**: 展示交易盈亏情况

**展示指标**:

| 指标 | 说明 | 计算方式 |
|-----|------|---------|
| 今日 P&L | 今日已实现盈亏 | 成交记录汇总 |
| 本周 P&L | 本周已实现盈亏 | 成交记录汇总 |
| 本月 P&L | 本月已实现盈亏 | 成交记录汇总 |
| 未实现 P&L | 持仓浮动盈亏 | 当前价 - 成本价 |
| 总 P&L | 累计盈亏 | 历史汇总 |

**P&L 图表**:
- 日收益曲线 (折线图)
- 月度收益柱状图
- 收益分布热力图

#### 3.2.3 市场行情

**功能描述**: 展示关注的交易对实时行情

**展示内容**:

| 字段 | 说明 |
|-----|------|
| 交易对 | 如 BTC/USDT |
| 最新价 | 实时价格 |
| 24h 涨跌幅 | 百分比，颜色区分 |
| 24h 成交量 | 成交量 |
| 24h 高/低 | 最高价/最低价 |
| 迷你 K 线图 | 最近 24h 走势 |

**数据来源**: DataHub Ticker API

**更新频率**: 实时 (WebSocket) 或 5 秒轮询

#### 3.2.4 热门交易对

**功能描述**: 展示市场热门交易对排行

**排行维度**:
- 24h 涨幅榜
- 24h 跌幅榜
- 24h 成交量榜
- 用户关注榜

**数据来源**: DataHub Ticker API

#### 3.2.5 市场新闻 (News)

**功能描述**: 展示加密货币市场新闻和动态

**新闻来源**:
- DataHub News API (待实现)
- 外部新闻聚合 API

**展示内容**:
- 新闻标题
- 摘要
- 发布时间
- 来源
- 相关代币标签

**交互**:
- 点击跳转原文
- 按代币筛选
- 按时间筛选

---

### 3.3 交易模块 (Trading Module)

#### 3.3.1 交易界面布局

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  [BTC/USDT ▼]  Binance  $42,150.50  +2.34%  Vol: 45,678 BTC               │
├───────────────────────────────────────┬─────────────────────────────────────┤
│                                       │          Order Book                 │
│                                       │  ┌───────────────────────────────┐  │
│                                       │  │ Price      │ Amount  │ Total │  │
│                                       │  ├───────────┼─────────┼───────┤  │
│         TradingView Chart             │  │ 42,160.00 │  1.234  │ ████  │  │
│                                       │  │ 42,155.00 │  0.567  │ ███   │  │
│         (K线图 + 技术指标)             │  │ 42,152.00 │  2.345  │ █████ │  │
│                                       │  ├─── Spread: $2.00 (0.004%) ───┤  │
│                                       │  │ 42,150.00 │  1.890  │ ████  │  │
│                                       │  │ 42,148.00 │  0.432  │ ██    │  │
│                                       │  │ 42,145.00 │  3.210  │ █████ │  │
│                                       │  └───────────────────────────────┘  │
├───────────────────────────────────────┼─────────────────────────────────────┤
│         Recent Trades                 │         Order Form                  │
│  ┌─────────────────────────────────┐  │  ┌─────────────────────────────────┐│
│  │ Time    │ Price   │ Amount     │  │  │ [● 买入] [○ 卖出]              ││
│  ├─────────┼─────────┼────────────┤  │  │ [● 限价] [○ 市价] [○ 组合单]    ││
│  │ 10:30:15│42,150.50│  0.123 ▲   │  │  │                                ││
│  │ 10:30:14│42,149.00│  0.567 ▼   │  │  │ 价格: [__42,150__] USDT       ││
│  │ 10:30:12│42,151.00│  1.234 ▲   │  │  │ 数量: [___0.1____] BTC        ││
│  └─────────────────────────────────┘  │  │ [25%] [50%] [75%] [100%]       ││
│                                       │  │                                ││
│                                       │  │ 可用: 10,000.00 USDT          ││
│                                       │  │ 预估: ≈ $4,215.05             ││
│                                       │  │                                ││
│                                       │  │    [  买入 BTC  ]              ││
│                                       │  └─────────────────────────────────┘│
└───────────────────────────────────────┴─────────────────────────────────────┘
```

#### 3.3.2 TradingView 集成

**功能描述**: 集成 TradingView 专业图表

**数据来源方案**:

| 方案 | 优点 | 缺点 | 推荐 |
|-----|------|------|------|
| 前端直连交易所 | 实时性最好，无后端压力 | 需处理跨域，暴露 API | ⭐ 推荐 |
| 通过 DataHub | 数据统一，可做缓存 | 增加延迟，后端压力 | 备选 |
| TradingView 内置数据 | 最简单 | 数据可能不一致 | 简单场景 |

**推荐实现**:
1. 使用 TradingView Charting Library
2. 实现 UDF DataFeed 接口
3. K 线数据从交易所 WebSocket 获取
4. 历史数据通过 DataHub API 回填

**图表功能**:
- 多时间周期切换 (1m, 5m, 15m, 1h, 4h, 1d)
- 技术指标 (MA, EMA, MACD, RSI, Bollinger Bands)
- 画线工具
- 多图表布局
- 价格提醒线

#### 3.3.3 订单簿 (Order Book)

**功能描述**: 展示交易对的实时订单簿深度

**数据来源**: 
- 实时: 交易所 WebSocket (推荐)
- 轮询: DataHub OrderBook API

**展示内容**:
- 买/卖档位 (默认各 15 档)
- 价格、数量、累计量
- 深度可视化柱状图
- 买卖价差 (Spread)

**交互**:
- 点击价格自动填入下单表单
- 深度聚合精度切换

#### 3.3.4 标准订单

**功能描述**: 创建限价单/市价单

**详见**: [OMS App 需求文档 - 标准订单创建](../oms/app-requirements.md#211-标准订单创建)

#### 3.3.5 组合单 (Bracket Order)

**功能描述**: 创建带止损/止盈的组合单

**详见**: [OMS App 需求文档 - 组合单创建](../oms/app-requirements.md#212-组合单-bracket-order-创建)

---

### 3.4 订单管理模块

#### 3.4.1 订单列表

**详见**: [OMS App 需求文档 - 订单列表](../oms/app-requirements.md#221-订单列表)

#### 3.4.2 订单详情

**详见**: [OMS App 需求文档 - 订单详情](../oms/app-requirements.md#222-订单详情)

#### 3.4.3 组合单管理

**详见**: [OMS App 需求文档 - 组合单管理](../oms/app-requirements.md#23-组合单管理模块)

---

### 3.5 账户模块

#### 3.5.1 交易账户管理

**功能描述**: 管理用户关联的交易所账户

**账户列表展示**:

| 字段 | 说明 |
|-----|------|
| 账户名称 | 如 BNC_MM01 |
| 交易所 | Binance / OKX / Gate.io |
| 状态 | 正常 / 断开 / 维护中 |
| 权限 | 现货 / 合约 / 杠杆 |
| 最后同步 | 最后数据同步时间 |

**账户操作**:
- 查看账户详情
- 刷新账户数据
- 账户余额/持仓查询

> **注意**: 账户的 API Key 配置在后台管理，前端不暴露

#### 3.5.2 余额查询

**详见**: [OMS App 需求文档 - 余额查询](../oms/app-requirements.md#241-余额查询)

#### 3.5.3 持仓查询

**详见**: [OMS App 需求文档 - 持仓查询](../oms/app-requirements.md#242-持仓查询)

---

### 3.6 AI 助手模块

#### 3.6.1 AI 交易助手

**功能描述**: 集成大语言模型，提供智能交易辅助

**功能列表**:

| 功能 | 描述 |
|-----|------|
| 市场分析 | 分析当前市场状况和趋势 |
| 交易建议 | 根据市场数据提供交易建议 |
| 风险评估 | 评估交易方案的风险 |
| 策略解读 | 解释技术指标和图形形态 |
| 新闻解读 | 分析新闻对市场的影响 |

**交互方式**:
- 聊天对话界面
- 快捷问题按钮
- 上下文关联 (当前交易对、持仓等)

**AI 上下文**:
```json
{
  "current_symbol": "BTC_USDT",
  "current_price": 42150.50,
  "user_position": {
    "symbol": "BTC_USDT",
    "side": "LONG",
    "quantity": 0.5,
    "entry_price": 41000
  },
  "market_data": {
    "24h_change": "+2.34%",
    "24h_volume": 45678
  }
}
```

**示例对话**:

```
用户: 现在适合买入 BTC 吗？

AI: 根据当前市场数据分析：

📊 技术面分析:
- BTC 当前价格 $42,150，24h 上涨 2.34%
- RSI(14) = 58，处于中性区间
- 价格位于 MA20 ($41,800) 上方，短期趋势向上
- MACD 呈金叉形态

⚠️ 风险提示:
- 接近前期阻力位 $42,500
- 建议分批建仓，控制仓位在总资产的 10-20%

💡 建议:
- 可考虑在 $41,800-42,000 区间分批买入
- 设置止损在 $40,500 (约 -4%)
- 目标止盈 $44,000-45,000

请注意：这只是参考建议，不构成投资建议，请自行评估风险。
```

#### 3.6.2 AI 配置

**可配置项**:

| 配置 | 说明 | 默认值 |
|-----|------|--------|
| AI 提供商 | OpenAI / Claude | Claude |
| 模型选择 | gpt-4 / claude-3-opus | claude-3-opus |
| 响应风格 | 保守 / 中性 / 激进 | 中性 |
| 上下文数量 | 保留的历史对话数 | 10 |

---

### 3.7 策略模块 (预留)

> **注意**: 此模块 API 尚未实现，先预留界面占位

#### 3.7.1 策略列表

**功能描述**: 展示用户的量化交易策略

**预留功能**:
- 策略列表展示
- 策略状态 (运行中/暂停/停止)
- 策略收益统计
- 策略参数配置

#### 3.7.2 策略详情

**预留功能**:
- 策略基本信息
- 策略参数
- 运行日志
- 交易记录
- 收益曲线

#### 3.7.3 策略回测

**预留功能**:
- 历史数据回测
- 回测报告
- 参数优化

---

## 4. 扩展功能模块

### 4.1 告警系统 (Alert System)

#### 4.1.1 价格告警

**功能描述**: 当价格达到指定条件时发送告警

**告警类型**:

| 类型 | 触发条件 |
|-----|---------|
| 价格上穿 | 价格 > 设定值 |
| 价格下穿 | 价格 < 设定值 |
| 涨幅超过 | 24h 涨幅 > X% |
| 跌幅超过 | 24h 跌幅 > X% |
| 价格区间 | 价格进入/离开区间 |

**告警渠道**:
- 应用内通知
- 浏览器通知
- 邮件通知 (可选)
- Webhook (可选)

**告警配置界面**:
```
┌─────────────────────────────────────────┐
│  创建价格告警                            │
├─────────────────────────────────────────┤
│  交易对:  [BTC_USDT ▼]                  │
│  交易所:  [Binance ▼]                   │
│                                         │
│  触发条件:                               │
│  [● 价格上穿] [○ 价格下穿]               │
│                                         │
│  目标价格: [____45000____] USDT         │
│  当前价格: 42,150.50 USDT               │
│  距离目标: +6.76%                        │
│                                         │
│  告警渠道:                               │
│  [✓] 应用内通知                          │
│  [✓] 浏览器推送                          │
│  [ ] 邮件通知                            │
│                                         │
│  备注: [________________]                │
│                                         │
│           [取消]  [创建告警]              │
└─────────────────────────────────────────┘
```

#### 4.1.2 订单告警

**触发条件**:
- 订单成交
- 订单取消
- 订单失败
- 止损/止盈触发

#### 4.1.3 账户告警

**触发条件**:
- 余额低于阈值
- 保证金率低于阈值
- 大额转账

#### 4.1.4 系统告警

**触发条件**:
- 交易所连接断开
- API 错误率过高
- 数据同步异常

---

### 4.2 投资组合分析 (Portfolio Analytics)

#### 4.2.1 资产配置分析

**展示内容**:
- 资产类型分布 (BTC, ETH, 稳定币, 其他)
- 交易所分布
- 风险敞口分析

#### 4.2.2 历史净值曲线

**功能描述**: 展示账户净值随时间变化的曲线

**数据来源**: 定期快照账户余额

**展示维度**:
- 总净值曲线
- 各账户净值曲线
- 与 BTC/ETH 对比

#### 4.2.3 交易统计

**统计指标**:

| 指标 | 说明 |
|-----|------|
| 总交易次数 | 成交订单数量 |
| 胜率 | 盈利交易 / 总交易 |
| 盈亏比 | 平均盈利 / 平均亏损 |
| 最大回撤 | 最大净值回撤比例 |
| 夏普比率 | 风险调整后收益 |
| 交易频率 | 日均交易次数 |

---

### 4.3 Watchlist (自选列表)

#### 4.3.1 自选列表管理

**功能描述**: 用户创建和管理自选交易对列表

**功能**:
- 创建多个自选列表
- 添加/删除交易对
- 拖拽排序
- 列表分组

#### 4.3.2 自选行情展示

**展示内容**:
- 自选列表快速切换
- 实时行情更新
- 快捷下单入口

---

### 4.4 交易日志 (Trade Journal)

#### 4.4.1 交易记录

**功能描述**: 详细记录每笔交易

**记录内容**:
- 交易基本信息
- 入场理由
- 出场理由
- 交易截图
- 复盘笔记

#### 4.4.2 交易复盘

**功能**:
- 按日期查看交易
- 标记重要交易
- 添加复盘笔记
- 导出交易报告

---

### 4.5 风险控制

#### 4.5.1 仓位管理

**功能**:
- 单笔最大仓位限制
- 单币种最大仓位限制
- 总仓位限制

#### 4.5.2 风险提醒

**提醒条件**:
- 单笔亏损超过阈值
- 日亏损超过阈值
- 连续亏损次数
- 保证金率警告

---

### 4.6 系统设置

#### 4.6.1 偏好设置

| 设置项 | 选项 |
|-------|------|
| 主题 | 深色 / 浅色 / 跟随系统 |
| 语言 | 中文 / English |
| 时区 | 自动 / 手动选择 |
| 计价货币 | USD / USDT / CNY |
| 默认交易所 | Binance / OKX / Gate.io |

#### 4.6.2 通知设置

| 设置项 | 说明 |
|-------|------|
| 浏览器通知 | 开启/关闭 |
| 声音提醒 | 开启/关闭 |
| 邮件通知 | 配置邮箱 |
| 通知时段 | 设置免打扰时段 |

#### 4.6.3 安全设置

| 设置项 | 说明 |
|-------|------|
| 修改密码 | 变更登录密码 |
| 登录历史 | 查看登录记录 |
| 会话管理 | 管理活跃会话 |

---

## 5. 技术规范

### 5.1 API 设计规范

#### 5.1.1 RESTful API

**URL 规范**:
```
GET    /api/v1/orders          # 列表
GET    /api/v1/orders/{id}     # 详情
POST   /api/v1/orders          # 创建
PUT    /api/v1/orders/{id}     # 更新
DELETE /api/v1/orders/{id}     # 删除
POST   /api/v1/orders/{id}/cancel  # 操作
```

**统一响应格式**:

成功响应:
```json
{
  "data": { ... },
  "pagination": {
    "page": 1,
    "page_size": 50,
    "total": 100,
    "total_pages": 2,
    "has_next": true,
    "has_prev": false
  }
}
```

错误响应:
```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Invalid parameter",
    "detail": "price must be greater than 0"
  }
}
```

#### 5.1.2 WebSocket API

**连接端点**: `wss://api.example.com/ws`

**消息格式**:
```json
{
  "type": "subscribe",
  "channel": "ticker",
  "symbol": "BTC_USDT.BNC"
}
```

**推送消息**:
```json
{
  "type": "ticker",
  "symbol": "BTC_USDT.BNC",
  "data": {
    "price": "42150.50",
    "change_24h": "+2.34%",
    "volume_24h": "45678.123"
  },
  "timestamp": 1706620800000
}
```

### 5.2 数据库设计

#### 5.2.1 用户表 (users)

```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(32) UNIQUE NOT NULL,
    password_hash VARCHAR(128) NOT NULL,
    email VARCHAR(255),
    display_name VARCHAR(50),
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 5.2.2 用户设置表 (user_settings)

```sql
CREATE TABLE user_settings (
    user_id INTEGER PRIMARY KEY REFERENCES users(id),
    theme VARCHAR(20) DEFAULT 'dark',
    language VARCHAR(10) DEFAULT 'zh-CN',
    timezone VARCHAR(50) DEFAULT 'UTC',
    quote_currency VARCHAR(10) DEFAULT 'USDT',
    default_exchange VARCHAR(10) DEFAULT 'BNC',
    notifications JSONB DEFAULT '{}',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 5.2.3 告警表 (alerts)

```sql
CREATE TABLE alerts (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    symbol VARCHAR(50) NOT NULL,
    exchange VARCHAR(10) NOT NULL,
    alert_type VARCHAR(20) NOT NULL,
    condition_type VARCHAR(20) NOT NULL,
    target_value DECIMAL(20, 8) NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    is_triggered BOOLEAN DEFAULT FALSE,
    triggered_at TIMESTAMP,
    note TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 5.2.4 自选列表表 (watchlists)

```sql
CREATE TABLE watchlists (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    name VARCHAR(50) NOT NULL,
    symbols JSONB DEFAULT '[]',
    sort_order INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 5.3 缓存策略

| 数据类型 | 缓存时间 | 缓存 Key 格式 |
|---------|---------|--------------|
| 用户信息 | 5 分钟 | `user:{user_id}` |
| 行情数据 | 1 秒 | `ticker:{symbol}` |
| 订单簿 | 实时 | `orderbook:{symbol}` |
| K 线数据 | 1 分钟 | `kline:{symbol}:{interval}` |
| 余额数据 | 30 秒 | `balance:{account}` |

---

## 6. 界面设计规范

### 6.1 设计原则

| 原则 | 说明 |
|-----|------|
| **专业感** | 参考主流交易所界面，保持专业交易风格 |
| **信息密度** | 合理利用空间，展示关键信息 |
| **实时反馈** | 数据实时更新，操作即时响应 |
| **错误预防** | 关键操作二次确认，风险提示明显 |
| **可定制** | 支持布局调整，满足个性化需求 |

### 6.2 配色方案

**深色主题 (默认)**:
```css
--bg-primary: #0D1117;
--bg-secondary: #161B22;
--bg-tertiary: #21262D;
--text-primary: #F0F6FC;
--text-secondary: #8B949E;
--accent-green: #3FB950;
--accent-red: #F85149;
--accent-blue: #58A6FF;
--border-color: #30363D;
```

**浅色主题**:
```css
--bg-primary: #FFFFFF;
--bg-secondary: #F6F8FA;
--bg-tertiary: #EAEEF2;
--text-primary: #1F2328;
--text-secondary: #656D76;
--accent-green: #1A7F37;
--accent-red: #CF222E;
--accent-blue: #0969DA;
--border-color: #D0D7DE;
```

### 6.3 字体规范

```css
--font-family: 'Inter', 'SF Pro Display', -apple-system, sans-serif;
--font-mono: 'JetBrains Mono', 'SF Mono', Menlo, monospace;

/* 数字使用等宽字体 */
.price, .amount, .percent {
    font-family: var(--font-mono);
    font-variant-numeric: tabular-nums;
}
```

### 6.4 响应式断点

```css
/* Mobile */
@media (max-width: 767px) { ... }

/* Tablet */
@media (min-width: 768px) and (max-width: 1023px) { ... }

/* Desktop */
@media (min-width: 1024px) and (max-width: 1439px) { ... }

/* Wide Desktop */
@media (min-width: 1440px) { ... }
```

---

## 7. 安全需求

### 7.1 认证安全

| 要求 | 实现 |
|-----|------|
| 密码存储 | bcrypt 哈希，cost factor ≥ 12 |
| Token 安全 | JWT HS256，定期轮换密钥 |
| Token 存储 | HttpOnly Cookie 或 localStorage + XSS 防护 |
| 会话管理 | 支持强制登出，Token 黑名单 |

### 7.2 传输安全

| 要求 | 实现 |
|-----|------|
| HTTPS | 强制 TLS 1.2+ |
| HSTS | 启用 Strict-Transport-Security |
| 证书 | 使用可信 CA 签发证书 |

### 7.3 应用安全

| 要求 | 实现 |
|-----|------|
| XSS 防护 | 输入过滤，输出编码，CSP |
| CSRF 防护 | SameSite Cookie，CSRF Token |
| SQL 注入 | 参数化查询，ORM |
| 速率限制 | 登录尝试限制，API 限流 |

### 7.4 敏感数据处理

| 数据 | 处理方式 |
|-----|---------|
| API Key | 后端存储，前端不可见 |
| 密码 | 不可逆哈希存储 |
| Token | 加密存储，安全传输 |
| 交易数据 | 传输加密，访问控制 |

---

## 8. 非功能性需求

### 8.1 性能要求

| 指标 | 目标值 |
|-----|--------|
| 首页加载时间 | < 2s (首屏) |
| API 响应时间 | < 200ms (P95) |
| WebSocket 延迟 | < 100ms |
| 图表渲染 | < 500ms |
| 订单提交到确认 | < 1s |

### 8.2 可用性要求

| 指标 | 目标值 |
|-----|--------|
| 系统可用性 | 99.9% |
| 计划外停机 | < 4 小时/年 |
| 故障恢复时间 | < 30 分钟 |

### 8.3 可扩展性要求

| 指标 | 目标值 |
|-----|--------|
| 并发用户 | 支持 1000+ |
| 日交易量 | 支持 100,000+ 订单/天 |
| 数据存储 | 支持 1 年+ 历史数据 |

### 8.4 兼容性要求

| 平台 | 版本要求 |
|-----|---------|
| Chrome | 90+ |
| Firefox | 90+ |
| Safari | 14+ |
| Edge | 90+ |
| 分辨率 | 1280x720 及以上 |

---

## 9. 项目规划

### 9.1 开发阶段

#### Phase 1: MVP (4-6 周)

**目标**: 核心交易功能可用

| 功能 | 优先级 | 预估工时 |
|-----|--------|---------|
| 用户认证 (登录/注册) | P0 | 1 周 |
| Dashboard 基础版 | P0 | 1 周 |
| 交易界面 (下单) | P0 | 2 周 |
| 订单管理 | P0 | 1 周 |
| 基础设置 | P1 | 0.5 周 |

#### Phase 2: 功能完善 (4-6 周)

**目标**: 完善交易体验

| 功能 | 优先级 | 预估工时 |
|-----|--------|---------|
| TradingView 集成 | P0 | 2 周 |
| 订单簿实时展示 | P0 | 1 周 |
| 组合单功能 | P1 | 1 周 |
| P&L 分析 | P1 | 1 周 |
| 告警系统 | P1 | 1 周 |

#### Phase 3: 智能增强 (4-6 周)

**目标**: AI 功能和高级分析

| 功能 | 优先级 | 预估工时 |
|-----|--------|---------|
| AI 交易助手 | P1 | 2 周 |
| 投资组合分析 | P1 | 1.5 周 |
| 交易日志 | P2 | 1 周 |
| 自选列表 | P2 | 0.5 周 |
| 风险控制 | P2 | 1 周 |

#### Phase 4: 策略模块 (待定)

**目标**: 量化策略自动化

| 功能 | 优先级 | 说明 |
|-----|--------|------|
| 策略管理 | P2 | 依赖策略 API |
| 策略回测 | P2 | 依赖历史数据 |
| 自动交易 | P2 | 高风险功能 |

### 9.2 里程碑

| 里程碑 | 目标日期 | 交付物 |
|-------|---------|--------|
| M1: MVP 上线 | T+6周 | 基础交易功能 |
| M2: 功能完善 | T+12周 | 完整交易体验 |
| M3: 智能增强 | T+18周 | AI 功能上线 |
| M4: 策略模块 | TBD | 量化策略功能 |

---

## 10. 附录

### 10.1 术语表

| 术语 | 英文 | 说明 |
|-----|------|------|
| 限价单 | Limit Order | 指定价格的订单 |
| 市价单 | Market Order | 按市场价立即成交 |
| 组合单 | Bracket Order | 含止损/止盈的订单组合 |
| 止损 | Stop Loss | 限制亏损的保护订单 |
| 止盈 | Take Profit | 锁定利润的保护订单 |
| 订单簿 | Order Book | 买卖挂单深度 |
| K 线 | Candlestick | 蜡烛图 |
| 滑点 | Slippage | 预期价格与成交价差异 |

### 10.2 参考文档

- [OMS API 接口文档](../oms/api-reference.md)
- [OMS App 需求文档](../oms/app-requirements.md)
- [DataHub API 文档](../datahub/README.md)
- [DataHub AI Tool 集成需求](../datahub/requirements.md)

### 10.3 变更历史

| 版本 | 日期 | 作者 | 变更内容 |
|-----|------|------|---------|
| 1.0.0 | 2026-01-30 | AI | 初始版本 |

---

*文档结束*

